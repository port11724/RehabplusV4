<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PN Case Detail - RehabPlus</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .sidebar {
            min-height: 100vh;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
        }
        .sidebar .nav-link {
            color: rgba(255,255,255,0.8);
            padding: 0.75rem 1rem;
            margin: 0.25rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.3s;
        }
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background: rgba(255,255,255,0.2);
            color: white;
        }
        .info-card {
            border-left: 4px solid #667eea;
        }
        .medical-section {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1rem;
        }
        /* Added styles for SOAP notes */
        .soap-card {
            background: #fdfdfd;
            border: 1px solid #eee;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        .soap-header {
            background: #f8f9fa;
            padding: 0.75rem 1.25rem;
            border-bottom: 1px solid #eee;
        }
        .soap-body {
            padding: 1.25rem;
        }
        .soap-body strong {
            color: #667eea;
        }
        
        /* Added styles for Attachments */
        #attachmentsList li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #eee;
        }
        #attachmentsList li:last-child {
            border-bottom: none;
        }
        .upload-area {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            border: 2px dashed #dee2e6;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <%- include('partials/sidebar', {user: user}) %>

            <!-- Main content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">
                        <a href="/dashboard" class="text-decoration-none text-muted">
                            <i class="bi bi-arrow-left"></i>
                        </a>
                        PN Case Detail
                    </h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <button type="button" class="btn btn-sm btn-primary" id="editBtn">
                            <i class="bi bi-pencil me-1"></i>Edit Medical Info
                        </button>
                    </div>
                </div>

                <!-- Case Information -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="card info-card">
                            <div class="card-body">
                                <h5 class="card-title">Case Information</h5>
                                <div class="row" id="caseInfo">
                                    <div class="col-md-12 text-center">
                                        <div class="spinner-border" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Patient Information (Read Only) -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="card" style="border-left: 4px solid #ffc107; background-color: #fff3cd;">
                            <div class="card-header" style="background-color: #ffc107;">
                                <h5 class="card-title mb-0"><i class="bi bi-person-badge"></i> Patient Information <small class="text-muted">(Registered Once)</small></h5>
                            </div>
                            <div class="card-body" style="background-color: white;">
                                <div class="row" id="patientInfo">
                                    <div class="col-md-12 text-center">
                                        <div class="spinner-border" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Medical Information (Editable) -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="card" style="border-left: 4px solid #4caf50; background-color: #e8f5e9;">
                            <div class="card-header" style="background-color: #4caf50; color: white;">
                                <h5 class="card-title mb-0"><i class="bi bi-heart-pulse"></i> Medical Information for This PN Case</h5>
                            </div>
                            <div class="card-body" style="background-color: white;">
                                <form id="medicalForm">
                                    <div class="row" id="medicalInfo">
                                        <div class="col-md-12 text-center">
                                            <div class="spinner-border" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mt-3" id="formActions" style="display:none;">
                                        <div class="col-md-12">
                                            <button type="submit" class="btn btn-primary">
                                                <i class="bi bi-save me-1"></i>Save Changes
                                            </button>
                                            <button type="button" class="btn btn-secondary" id="cancelBtn">
                                                <i class="bi bi-x-circle me-1"></i>Cancel
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ******** NEW: PT Assessment (Read Only) ******** -->
                <div class="row mb-4" id="ptAssessmentSection" style="display:none;">
                    <div class="col-md-12">
                        <div class="card" style="border-left: 4px solid #2196F3; background-color: #e3f2fd;">
                            <div class="card-header" style="background-color: #2196F3; color: white;">
                                <h5 class="card-title mb-0"><i class="bi bi-clipboard-pulse"></i> PT Assessment <small class="text-white">(On Acceptance)</small></h5>
                            </div>
                            <div class="card-body" style="background-color: white;">
                                <div class="row" id="ptAssessmentInfo">
                                    <!-- Content will be loaded by JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ******** NEW: SOAP Notes Section ******** -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="card" style="border-left: 4px solid #9c27b0; background-color: #f3e5f5;">
                            <div class="card-header" style="background-color: #9c27b0; color: white;">
                                <h5 class="card-title mb-0"><i class="bi bi-journal-medical"></i> SOAP Notes History</h5>
                            </div>
                            <div class="card-body" style="background-color: white;">
                                <div id="soapNotesSection">
                                    <p class="text-muted">No SOAP notes recorded yet.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ******** NEW: Attachments Section ******** -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Case Attachments</h5>
                                <div class="upload-area mb-3">
                                    <h6>Upload New File</h6>
                                    <div class="input-group">
                                        <input type="file" class="form-control" id="fileInput" aria-describedby="uploadButton">
                                        <button class="btn btn-success" type="button" id="uploadButton" onclick="handleUpload()">
                                            <i class="bi bi-upload me-1"></i> Upload
                                        </button>
                                    </div>
                                </div>
                                
                                <h6>Uploaded Files:</h6>
                                <ul class="list-group list-group-flush" id="attachmentsList">
                                    <li class="list-group-item text-muted">No attachments found.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Visits Section -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Treatment Visits</h5>
                                <div id="visitsSection">
                                    <p class="text-muted">No visits recorded yet.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    <script>
        const pnId = <%= pnId %>;
        let isEditing = false;
        let currentPnCase = null;
        const loggedInUser = JSON.parse(localStorage.getItem('user'));

        // Load PN case details
        async function loadPNCase() {
            try {
                const token = getCookie('authToken');
                const response = await fetch(`/api/pn/${pnId}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    currentPnCase = await response.json();
                    displayCaseInfo(currentPnCase);
                    displayPatientInfo(currentPnCase);
                    displayMedicalInfo(currentPnCase, false);
                    displayPTAssessment(currentPnCase);
                    displaySOAPNotes(currentPnCase.soap_notes);
                    displayAttachments(currentPnCase.attachments); // Add this
                    displayVisits(currentPnCase.visits);
                } else {
                    alert('Failed to load PN case');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error loading PN case');
            }
        }

        function displayCaseInfo(pnCase) {
            // ******** FIX: REMOVED Priority display line ********
            const html = `
                <div class="col-md-6">
                    <p><strong>PN Code:</strong> <span class="badge bg-secondary">${pnCase.pn_code}</span></p>
                    <p><strong>Status:</strong> ${renderStatus(pnCase.status)}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Source Clinic:</strong> ${pnCase.source_clinic_name}</p>
                    <p><strong>Target Clinic:</strong> ${pnCase.target_clinic_name}</p>
                    <p><strong>Created:</strong> ${moment(pnCase.created_at).format('DD/MM/YYYY HH:mm')}</p>
                </div>
            `;
            document.getElementById('caseInfo').innerHTML = html;
        }

        function displayPatientInfo(pnCase) {
            const html = `
                <div class="col-md-6">
                    <p><strong>HN:</strong> ${pnCase.hn}</p>
                    <p><strong>PT Number:</strong> ${pnCase.pt_number}</p>
                    <p><strong>Full Name:</strong> ${pnCase.first_name} ${pnCase.last_name}</p>
                    <p><strong>DOB:</strong> ${moment(pnCase.dob).format('DD/MM/YYYY')}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Gender:</strong> ${pnCase.gender || 'N/A'}</p>
                    <p><strong>General Diagnosis:</strong> ${pnCase.patient_diagnosis || 'N/A'}</p>
                    <p><strong>Rehab Goal:</strong> ${pnCase.rehab_goal || 'N/A'}</p>
                    <p><strong>General Precaution:</strong> ${pnCase.precaution || 'N/A'}</p>
                </div>
            `;
            document.getElementById('patientInfo').innerHTML = html;
        }

        function displayMedicalInfo(pnCase, editMode) {
            const html = editMode ? `
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">Diagnosis for This PN</label>
                        <textarea class="form-control" name="diagnosis" rows="2">${pnCase.diagnosis || ''}</textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Purpose/Referral Reason</label>
                        <textarea class="form-control" name="purpose" rows="2">${pnCase.purpose || ''}</textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Current Medications</label>
                        <textarea class="form-control" name="current_medications" rows="2">${pnCase.current_medications || ''}</textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Allergies</label>
                        <textarea class="form-control" name="allergies" rows="2">${pnCase.allergies || ''}</textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Pain Scale (0-10)</label>
                        <input type="number" class="form-control" name="pain_scale" min="0" max="10" value="${pnCase.pain_scale || ''}">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">Precautions for This PN</label>
                        <textarea class="form-control" name="pn_precautions" rows="2">${pnCase.pn_precautions || ''}</textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Contraindications</label>
                        <textarea class="form-control" name="pn_contraindications" rows="2">${pnCase.pn_contraindications || ''}</textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Treatment Goals</label>
                        <textarea class="form-control" name="treatment_goals" rows="2">${pnCase.treatment_goals || ''}</textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Expected Outcomes</label>
                        <textarea class="form-control" name="expected_outcomes" rows="2">${pnCase.expected_outcomes || ''}</textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Medical Notes</label>
                        <textarea class="form-control" name="medical_notes" rows="2">${pnCase.medical_notes || ''}</textarea>
                    </div>
                </div>
            ` : `
                <div class="col-md-6">
                    <p><strong>Diagnosis:</strong> ${pnCase.diagnosis || 'N/A'}</p>
                    <p><strong>Purpose:</strong> ${pnCase.purpose || 'N/A'}</p>
                    <p><strong>Current Medications:</strong> ${pnCase.current_medications || 'None'}</p>
                    <p><strong>Allergies:</strong> ${pnCase.allergies || 'None'}</p>
                    <p><strong>Pain Scale:</strong> ${pnCase.pain_scale !== null ? `${pnCase.pain_scale}/10` : 'Not assessed'}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Precautions:</strong> ${pnCase.pn_precautions || 'None'}</p>
                    <p><strong>Contraindications:</strong> ${pnCase.pn_contraindications || 'None'}</p>
                    <p><strong>Treatment Goals:</strong> ${pnCase.treatment_goals || 'Not specified'}</p>
                    <p><strong>Expected Outcomes:</strong> ${pnCase.expected_outcomes || 'Not specified'}</p>
                    <p><strong>Medical Notes:</strong> ${pnCase.medical_notes || 'None'}</p>
                </div>
            `;

            document.getElementById('medicalInfo').innerHTML = html;
            document.getElementById('formActions').style.display = editMode ? 'block' : 'none';
        }

        // --- NEW FUNCTION: Display PT Assessment ---
        function displayPTAssessment(pnCase) {
            // Check if PT assessment data exists
            if (pnCase.pt_diagnosis || pnCase.pt_chief_complaint) {
                const html = `
                    <div class="col-md-6">
                        <p><strong>Physiotherapy Diagnosis:</strong> ${pnCase.pt_diagnosis || 'N/A'}</p>
                        <p><strong>Chief Complaint:</strong> ${pnCase.pt_chief_complaint || 'N/A'}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Present History:</strong> ${pnCase.pt_present_history || 'N/A'}</p>
                        <p><strong>Pain Score (at acceptance):</strong> ${pnCase.pt_pain_score !== null ? `${pnCase.pt_pain_score}/10` : 'N/A'}</p>
                    </div>
                `;
                document.getElementById('ptAssessmentInfo').innerHTML = html;
                document.getElementById('ptAssessmentSection').style.display = 'block';
            } else {
                // Hide the section if no data (e.g., for CL001 cases)
                document.getElementById('ptAssessmentSection').style.display = 'none';
            }
        }

        // --- NEW FUNCTION: Display SOAP Notes ---
        function displaySOAPNotes(soapNotes) {
            const container = document.getElementById('soapNotesSection');
            if (!soapNotes || soapNotes.length === 0) {
                container.innerHTML = '<p class="text-muted">No SOAP notes recorded yet.</p>';
                return;
            }

            container.innerHTML = soapNotes.map(note => `
                <div class="soap-card">
                    <div class="soap-header d-flex justify-content-between">
                        <strong>Recorded: ${moment(note.timestamp).format('DD/MM/YYYY HH:mm')}</strong>
                        <small>By: ${note.created_by_name || 'N/A'}</small>
                    </div>
                    <div class="soap-body">
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Subjective:</strong><br>${(note.subjective || 'N/A').replace(/\n/g, '<br>')}</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Objective:</strong><br>${(note.objective || 'N/A').replace(/\n/g, '<br>')}</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Assessment:</strong><br>${(note.assessment || 'N/A').replace(/\n/g, '<br>')}</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Plan:</strong><br>${(note.plan || 'N/A').replace(/\n/g, '<br>')}</p>
                            </div>
                        </div>
                        ${note.notes ? `<hr><p><strong>Additional Notes:</strong><br>${note.notes.replace(/\n/g, '<br>')}</p>` : ''}
                    </div>
                </div>
            `).join('');
        }

        // --- NEW FUNCTION: Display Attachments ---
        function displayAttachments(attachments) {
            const list = document.getElementById('attachmentsList');
            if (!attachments || attachments.length === 0) {
                list.innerHTML = '<li class="list-group-item text-muted">No attachments found.</li>';
                return;
            }

            // ******** PERMISSION CHANGE ********
            const allowedDeleteRoles = ['ADMIN', 'PT', 'PT_ADMIN'];

            list.innerHTML = attachments.map(att => `
                <li class="list-group-item" id="attachment-${att.id}">
                    <div>
                        <i class="bi bi-file-earmark-text me-2"></i>
                        <strong>${att.file_name}</strong>
                        <br>
                        <small class="text-muted">
                            Uploaded by ${att.uploaded_by_name || 'N/A'} on ${moment(att.created_at).format('DD/MM/YYYY')}
                            (${(att.file_size / 1024).toFixed(1)} KB)
                        </small>
                    </div>
                    <div>
                        <a href="/api/attachment/${att.id}/download" class="btn btn-sm btn-primary" title="Download">
                            <i class="bi bi-download"></i>
                        </a>
                        ${(loggedInUser && allowedDeleteRoles.includes(loggedInUser.role)) ? 
                        `<button class="btn btn-sm btn-danger ms-1" onclick="deleteAttachment(${att.id})" title="Delete">
                            <i class="bi bi-trash"></i>
                        </button>` : ''}
                    </div>
                </li>
            `).join('');
        }
        
        // --- NEW FUNCTION: Handle File Upload ---
        async function handleUpload() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            const uploadButton = document.getElementById('uploadButton');

            if (!file) {
                alert('Please select a file to upload.');
                return;
            }
            
            uploadButton.disabled = true;
            uploadButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Uploading...';

            const formData = new FormData();
            formData.append('file', file);

            try {
                const token = getCookie('authToken');
                const response = await fetch(`/api/pn/${pnId}/upload`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                        // 'Content-Type' is set automatically by FormData
                    },
                    body: formData
                });

                if (response.ok) {
                    const result = await response.json();
                    alert('File uploaded successfully!');
                    fileInput.value = ''; // Clear file input
                    
                    // Add new attachment to list
                    if (!currentPnCase.attachments || currentPnCase.attachments.length === 0) {
                        document.getElementById('attachmentsList').innerHTML = ''; // Clear "No attachments" message
                        currentPnCase.attachments = [];
                    }
                    currentPnCase.attachments.unshift(result.attachment);
                    displayAttachments(currentPnCase.attachments);

                } else {
                    const error = await response.json();
                    alert(`Upload failed: ${error.error}`);
                }
            } catch (error) {
                console.error('Upload error:', error);
                alert('An error occurred during upload.');
            } finally {
                uploadButton.disabled = false;
                uploadButton.innerHTML = '<i class="bi bi-upload me-1"></i> Upload';
            }
        }
        
        // --- NEW FUNCTION: Delete Attachment ---
        async function deleteAttachment(attachmentId) {
            if (!confirm('Are you sure you want to delete this file? This cannot be undone.')) {
                return;
            }

            try {
                const token = getCookie('authToken');
                const response = await fetch(`/api/attachment/${attachmentId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    alert('Attachment deleted.');
                    // Remove from UI
                    document.getElementById(`attachment-${attachmentId}`).remove();
                    // Remove from local data
                    currentPnCase.attachments = currentPnCase.attachments.filter(att => att.id !== attachmentId);
                    if (currentPnCase.attachments.length === 0) {
                        displayAttachments(currentPnCase.attachments); // Show "No attachments"
                    }
                } else {
                    const error = await response.json();
                    alert(`Delete failed: ${error.error}`);
                }
            } catch (error) {
                console.error('Delete error:', error);
                alert('An error occurred while deleting the file.');
            }
        }


        function displayVisits(visits) {
            if (!visits || visits.length === 0) {
                document.getElementById('visitsSection').innerHTML = '<p class="text-muted">No visits recorded yet.</p>';
                return;
            }

            const html = `
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Visit #</th>
                            <th>Date</th>
                            <th>Therapist</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${visits.map(visit => `
                            <tr>
                                <td>${visit.visit_no}</td>
                                <td>${moment(visit.visit_date).format('DD/MM/YYYY')}</td>
                                <td>${visit.therapist_name || 'Not assigned'}</td>
                                <td>${renderStatus(visit.status)}</td>
                                <td>
                                    <button class="btn btn-sm btn-info" onclick="viewVisit(${visit.id})">
                                        <i class="bi bi-eye"></i> View
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('visitsSection').innerHTML = html;
        }

        // Edit mode
        document.getElementById('editBtn').addEventListener('click', () => {
            isEditing = true;
            displayMedicalInfo(currentPnCase, true);
        });

        document.getElementById('cancelBtn').addEventListener('click', () => {
            isEditing = false;
            displayMedicalInfo(currentPnCase, false);
        });

        // Save medical information
        document.getElementById('medicalForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);

            try {
                const token = getCookie('authToken');
                const response = await fetch(`/api/pn/${pnId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    alert('Medical information updated successfully');
                    isEditing = false;
                    loadPNCase(); // Reload
                } else {
                    const error = await response.json();
                    alert(error.error || 'Failed to update');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error updating medical information');
            }
        });

        // Helper functions
        function renderStatus(status) {
            const colors = {
                'PENDING': 'warning',
                'ACCEPTED': 'info',
                'IN_PROGRESS': 'primary',
                'COMPLETED': 'success',
                'CANCELLED': 'danger',
                'SCHEDULED': 'secondary'
            };
            return `<span class="badge bg-${colors[status] || 'secondary'}">${status}</span>`;
        }

        function renderPriority(priority) {
            // This function is no longer accurate as priority was removed,
            // but left here in case it's used elsewhere, though it shouldn't be.
            if (!priority) return ''; // Don't display anything
            const colors = {
                'LOW': 'secondary',
                'NORMAL': 'primary',
                'HIGH': 'warning',
                'URGENT': 'danger'
            };
            return `<span class="badge bg-${colors[priority] || 'secondary'}">${priority}</span>`;
        }

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        function viewVisit(visitId) {
            window.location.href = `/visit/${visitId}`;
        }

        // Load on page load
        document.addEventListener('DOMContentLoaded', loadPNCase);
    </script>
</body>
</html>